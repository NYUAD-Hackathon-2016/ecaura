<!doctype html>
<html>
<style>
path { 
    fill: none;
}

.axis path,
.axis line {
    fill: none;
    stroke: grey;
    stroke-width: 1;
    shape-rendering: crispEdges;
}
</style>
  <head>
    <meta charset="utf-8"/>
    <script src="https://polygit.org/components/webcomponentsjs/webcomponents-lite.min.js"></script>
    <link href="https://polygit.org/components/polymer/polymer.html" rel="import">
<link rel="import" href="https://polygit.org/components/paper-tabs/paper-tabs.html">
<link rel="import" href="https://polygit.org/components/paper-input/paper-input.html">
<link rel="import" href="https://polygit.org/components/paper-button/paper-button.html">

    <script src='https://cdn.firebase.com/js/client/2.3.0/firebase.js'></script>
    <link rel='stylesheet' type='text/css' href='index.css'>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>

        <script src='io.js'></script>
    <script src='../TestingLineChart/plot.js'></script>

    <title>Ecaura</title> 
  </head>
  <body>

<div id="logo">

          <img src="ecauragreen.png" alt="logo" height="25px" >

            <select id='monthInput' >
        <option value=''>Month</option>
        <option selected value='january'>Jan</option>
        <option value='february'>Feb</option>
        <option value='march'>Mar</option>
        <option value='april'>Apr</option>
        <option value='may'>May</option>
        <option value='june'>Jun</option>
        <option value='july'>Jul</option>
        <option value='august'>Aug</option>
        <option value='september'>Sep</option>
        <option value='october'>Oct</option>
        <option value='november'>Nov</option>
        <option value='december'>Dec</option>
        </select> 

        <select id='yearInput'>
        <option value=''>Year</option>
        <option value='2006'>2006</option>
        <option value='2007'>2007</option>
        <option value='2008'>2008</option>
        <option value='2009'>2009</option>
        <option value='2010'>2010</option>
        <option value='2011'>2011</option>
        <option value='2012'>2012</option>
        <option value='2013'>2013</option>
        <option value='2014'>2014</option>
        <option value='2015'>2015</option>
        <option selected value='2016'>2016</option>
        <option value='2017'>2017</option>
        <option value='2018'>2018</option>
        <option value='2019'>2019</option>
        <option value='2020'>2020</option>
        </select> 
        <br>
        </div>

    <!-- Left Side Form -->
    <div id="ParameterBox">
        <!-- Tab Titles (Parameters) -->
        
        <!-- Logo and Date -->
        


      <paper-tabs id="papertabs" selected="0">
      <paper-tab data-toggle="tab" href="#water" data-id:"water">Water</paper-tab>
         <paper-tab data-toggle="tab" href="#electricity">Electricity</paper-tab>
          <paper-tab data-toggle="tab" href="#waste">Waste</paper-tab>
          <paper-tab data-toggle="tab" href="#fuel">Fuel</paper-tab>
          <paper-tab data-toggle="tab" href="#food">Food</paper-tab></paper-tabs>
        <!-- Content for each tab -->
        <div class="tab-content"> 


            <div id="water" class="tab-pane fade in active">



              
              <p class="ParameterDescription"> 
            <!-- SubContent for each tab -->
           
                <paper-input id='WaterReservoir' label='Water Reservoir (litres/month)'></paper-input><br>
                <paper-input id='GroundWater' label='Ground Water (litres/month)'></paper-input><br>
                <paper-input id='DesalinatedWater' label='Desalinated Water (litres/month)'></paper-input><br>
                <paper-input id='RecycledWater' label='RecycledWater (litres/month)'></paper-input><br>             
              </p>
          </div>
          

            <div id="electricity" class="tab-pane fade">
              <p class="ParameterDescription">
               <!-- SubContent for each tab -->
              <paper-input   id='Nuclear' label='Nuclear (kWh/month)'></paper-input><br>
                <paper-input   id='Solar' label='Solar (kWh/month)'></paper-input><br>
                <paper-input  id='Wind' label='Wind (kWh/month)'></paper-input><br>
                <paper-input   id='HydroElectric' label='HydroElectric (kWh/month)'></paper-input><br>
                <paper-input  id='FossilFuels' label='Fossil Fuels (kWh/month)'></paper-input>
              </p>
            </div>
          


            <div id="waste" class="tab-pane fade">
              <p class="ParameterDescription"> 
          <!-- SubContent for each tab -->

                <paper-input  id='Plastic' label='Plastic (kg/month)'></paper-input><br>
                <paper-input  id='Paper' label='Paper (kg/month)'></paper-input><br>
                <paper-input  id='Glass' label='Glass (kg/month)'></paper-input><br>
                <paper-input  id='Metal' label='Metal (kg/month)'></paper-input><br>
                <paper-input  id='Landfill' label='Landfill (kg/month)'></paper-input></p>
            </div>
          

            <div id="fuel" class="tab-pane fade">
              <p class="ParameterDescription">
            <!-- SubContent for each tab -->
          <paper-input  id='NaturalGas' label='Natural Gas (litres/month)'></paper-input><br>
                <paper-input id='FuelOil' label='Fuel Oil (litres/month)'></paper-input><br>
                <paper-input id='LPG' label='LPG (litres/month)'></paper-input></p>
            </div>
          

            <div id="food" class="tab-pane fade">
              <p class="ParameterDescription">
            <!-- SubContent for each tab -->
            
          
  
          <paper-input  id='Beef' placeholder='Amount of Beef '></paper-input><br>
                <paper-input   id='Chicken' placeholder='Chicken'></paper-input><br>
                <paper-input  id='Dairy' placeholder='Dairy'></paper-input><br>
                <paper-input   id='Veggies' placeholder='Veggies'></paper-input><br>
                <paper-input   id='Fruits' placeholder='Fruits'></paper-input><br>
                <paper-input   id='Grains' placeholder='Grains'></paper-input></p>
            </div>
                      <paper-button raised type="submit" id="submitButton"> Add</paper-button> <br> <br> <br>
                      <paper-button raised id="clickMe" type="button" value="score" onclick=alert("get_score(firebasepath,nyuad);");> Get Score!</paper-button>

      </div> 
    


    


 <!-- Right Side Panel -->

  </div>
      <div id="OutputBox">
          <div id="InputVisualization">
          â€‹
          </div>
        <div id="OverallVisualization">
          <h1 class="Heading">OVERVIEW</h1>
        </div>
    </div>
    
    
    <script>
    var firebasepath = "https://ecaura.firebaseIO.com"
    console.log("Starting request")
    var myDataRef = new Firebase(firebasepath);
    console.log("Connected")
    // Set the dimensions of the canvas / graph


    // Parse the date / time
    var parseDate = d3.time.format("%Y %B").parse;
          var fields = ["WaterReservoir", "GroundWater", "DesalinatedWater", "RecycledWater", "Nuclear", "Solar", "Wind", "HydroElectric", 
          "FossilFuels", "Plastic", "Paper", "Glass", "Metal", "Landfill", "NaturalGas", "FuelOil", "LPG", "Beef", "Chicken", "Dairy", "Veggies", "Fruits", "Grains"]

    console.log("About to create listener")

    function clear_fields(fields) {
       for (i in fields) {
            console.log($("#" + fields[i]))
            $("#" + fields[i]).val('');
          }  
    }

    function update_graphs() {
      current_graph = $(".iron-selected").attr("href")
        current_graph = current_graph.substring(1, current_graph.length);
        console.log(current_graph)
        //console.log($(".iron-selected").value);
        console.log("Change found.")
          //get_feature(firebasepath, "electricity")
        console.log(d3.select("svg"))
        //d3.select('svg').remove();
        //d3.select('svg').remove();
        console.log(d3.select("svg"))

        var x1 = get_org(firebasepath, "nyuad")
          console.log(x1)
          data = x1[current_graph]

        console.log(data)
        if (data) {
          d3.selectAll("#InputVisualization > *").remove();
          add_series_to_svg(data, parseDate, "#InputVisualization");
        }
        var averages = get_score(firebasepath, "nyuad")
        d3.selectAll("#OverallVisualization > *").remove();
        add_many_series_to_svg(averages, parseDate, "#OverallVisualization")
    }

    myDataRef.on('value', function(snapshot) {
        update_graphs()
        // current_graph = $(".iron-selected").attr("href")
        // current_graph = current_graph.substring(1, current_graph.length);
        // console.log(current_graph)
        // //console.log($(".iron-selected").value);
        // console.log("Change found.")
        //   //get_feature(firebasepath, "electricity")
        // console.log(d3.select("svg"))
        // //d3.select('svg').remove();
        // //d3.select('svg').remove();
        // console.log(d3.select("svg"))

        // var x1 = get_org(firebasepath, "nyuad")
        //   console.log(x1)
        //   data = x1[current_graph]

        // console.log(data)
        // if (data) {
        //   d3.selectAll("#InputVisualization > *").remove();
        //   add_series_to_svg(data, parseDate, "#InputVisualization");
        // }
        // var averages = get_score(firebasepath, "nyuad")
        // d3.selectAll("#OverallVisualization > *").remove();
        // add_many_series_to_svg(averages, parseDate, "#OverallVisualization")
        
        });
      $('#submitButton').on('click', function () {
          d3.select("svg").remove();


          var name = "nyuad"
          var month = $('#monthInput').val();
          var year = $('#yearInput').val();

          var water_ones = ["WaterReservoir", "GroundWater", "DesalinatedWater", "RecycledWater"]
          var electricity_ones = ["Nuclear", "Solar", "Wind", "HydroElectric", "FossilFuels"]
          var waste_ones = ["Plastic", "Paper", "Glass", "Metal", "Landfill"]
          var fuel_ones = ["NaturalGas", "FuelOil", "LPG"]
          var food_ones = ["Beef", "Chicken", "Dairy", "Veggies", "Fruits", "Grains"]

          water_total = 0
          electricity_total = 0
          waste_total = 0
          fuel_total = 0
          food_total = 0
          var newdate = year + " " + month;

          for (i in water_ones) {
            feature = water_ones[i]
            var val = $("#" + feature).val();
            if (val > 0) { 
              d3.select("svg").remove();
              set_date(firebasepath, name, feature, newdate, {date: newdate, value:val});
            }
            water_total = water_total + parseInt(val);
            $("#" + feature).val('');
          }
          if (water_total > 0) {

            console.log("Added some waters")
            d3.select("svg").remove();
            set_date(firebasepath, name, "water", newdate, {date: newdate, value:water_total} )
            clear_fields(water_ones)

          }



          for (i in electricity_ones) {
            feature = electricity_ones[i]
            console.log("#" + feature)
            var val = $("#" + feature).val();
            if (val > 0) { 
              d3.select("svg").remove();
              set_date(firebasepath, name, feature, newdate, {date: newdate, value:val});
            }
            electricity_total = electricity_total + parseInt(val);
            $("#" + feature).val('');
          }
          if (electricity_total > 0) {
            console.log("Added some electricity")
            d3.select("svg").remove();
            set_date(firebasepath, name, "electricity", newdate, {date: newdate, value:electricity_total} )
            clear_fields(electricity_ones)

          }

          for (i in waste_ones) {
            feature = waste_ones[i]
            var val = $("#" + feature).val();
            if (val > 0) { 
              d3.select("svg").remove();
              set_date(firebasepath, name, feature, newdate, {date: newdate, value:val});
            }
            waste_total = waste_total + parseInt(val);
            $("#" + feature).val('');
          }
          if (waste_total > 0) {
            console.log("Added some wastes")
            d3.select("svg").remove();
            set_date(firebasepath, name, "waste", newdate, {date: newdate, value:waste_total} )
            clear_fields(waste_ones)

          }

          for (i in fuel_ones) {
            feature = fuel_ones[i]
            var val = $("#" + feature).val();
            if (val > 0) { 
              d3.select("svg").remove();
              set_date(firebasepath, name, feature, newdate, {date: newdate, value:val});
            }
            fuel_total = fuel_total + parseInt(val);
            $("#" + feature).val('');
          }
          if (fuel_total > 0) {
            d3.select("svg").remove();
           console.log("Added some fuels")

            set_date(firebasepath, name, "fuel", newdate, {date: newdate, value:fuel_total} )
            clear_fields(fuel_ones)

          }

          for (i in food_ones) {
            feature = food_ones[i]
            var val = $("#" + feature).val();
            if (val > 0) { 
              d3.select("svg").remove();
              set_date(firebasepath, name, feature, newdate, {date: newdate, value:val});
            }
            food_total = food_total + parseInt(val);
            $("#" + feature).val('');
          }
          if (food_total > 0) {
            d3.select("svg").remove();
            console.log("Added some electricity")
            set_date(firebasepath, name, "food", newdate, {date: newdate, value:food_total} )
            clear_fields(food_ones)
          }

        d3.selectAll("#OverallVisualization > *").remove();
        var averages = get_score(firebasepath, name)
        add_many_series_to_svg(averages, parseDate, "#OverallVisualization")

         

      });
      $('#papertabs').on('click', function() {
        console.log("Tab was clicked!");

          for (i in fields) {
            //console.log($("#" + fields[i]))
            $("#" + fields[i]).val('');
          }   
          update_graphs()


 
      });
      


      function displayChatMessage(name, text) {

        $('<div/>').text(text).prepend($('<em/>').text(name+': ')).appendTo($('#messagesDiv'));
        $('#messagesDiv')[0].scrollTop = $('#messagesDiv')[0].scrollHeight;
      };
    </script>

  </body>
</html>
